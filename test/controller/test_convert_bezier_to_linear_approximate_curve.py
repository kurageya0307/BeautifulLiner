
import os
import sys

sys.path.append(os.path.join(os.path.dirname(__file__), '../../model'))
from point import Point

sys.path.append(os.path.join(os.path.dirname(__file__), '../../controller'))
from convert_bezier_to_linear_approximate_curve import *
from read_cubic_bezier_curve_from_svg_file import readCubicBezierCurveFromSvgFile

import unittest

class TestApproximateCurveWithLineSegments(unittest.TestCase):
    def testGetEquallyDividedPointsBetween2Points(self):
        point_a = Point(0.0, 0.0)
        point_b = Point(10.0, 10.0)
        division_num = 10

        points = getEquallyDividedPointsBetween2Points(point_a, point_b, division_num)

        answer = []
        for i in range(division_num):
            answer.append( [float(i), float(i)] )
        #end for
        answer.append( [10.0, 10.0] )

        for i, point in enumerate(points):
            self.assertEqual(point.x, answer[i][0])
            self.assertEqual(point.y, answer[i][1])
            #print( "{}, {}, {}".format(i, point.x, point.y) )
        #end for

    #end def testGetEquallyDividedPointsBetween2Points

    def testGetInternalDivisionPoint(self):
        point_a = Point(1.0, 1.0)
        point_b = Point(10.0, 10.0)

        point = getInternalDivisionPoint(point_a, point_b, 1.0, 2.0)

        answer = [4.0, 4.0]
        self.assertEqual(point.x, answer[0])
        self.assertEqual(point.y, answer[1])
        #print( "{}, {}".format(point.x, point.y) )

    #end def testGetInternalDivisionPoint

    def testConvertBezierToLinearApproximateCurve(self):
        cubic_bezier_curve = readCubicBezierCurveFromSvgFile("data/aaa.svg")
        linear_approximate_curve = convertBezierToLinearApproximateCurve(cubic_bezier_curve, 1.0)

        the_answers = ( (624.369,665.275),
                        (624.3127364215528,665.1765072886298),
                        (624.1490954540547,664.8849358600584),
                        (623.8858017492711,664.4061457725948),
                        (623.5305799589677,663.7459970845481),
                        (623.0911547349099,662.9103498542274),
                        (622.575250728863,661.9050641399417),
                        (621.9905925925926,660.7359999999999),
                        (621.3449049778642,659.4090174927112),
                        (620.6459125364431,657.9299766763847),
                        (619.901339920095,656.3047376093294),
                        (619.1189117805853,654.5391603498542),
                        (618.3063527696792,652.6391049562682),
                        (617.4713875391426,650.6104314868804),
                        (616.6217407407407,648.459),
                        (615.765137026239,646.1906705539359),
                        (614.9093010474031,643.811303206997),
                        (614.0619574559983,641.3267580174928),
                        (613.2308309037902,638.7428950437318),
                        (612.423646042544,636.0655743440233),
                        (611.6481275240255,633.3006559766764),
                        (610.912,630.454),
                        (610.2102071050642,627.6262238419176),
                        (609.5329221466366,624.915736313573),
                        (608.8811428571428,622.3246559766764),
                        (608.25586696901,619.8551013929382),
                        (607.6580922146637,617.5091911240687),
                        (607.0888163265306,615.2890437317784),
                        (606.549037037037,613.1967777777778),
                        (606.0397520786092,611.2345118237771),
                        (605.5619591836736,609.4043644314869),
                        (605.116656084656,607.7084541626175),
                        (604.7048405139834,606.1488995788792),
                        (604.3275102040816,604.7278192419826),
                        (603.9856628873772,603.4473317136378),
                        (603.6802962962963,602.3095555555556),
                        (603.4124081632655,601.316609329446),
                        (603.1829962207105,600.4706115970197),
                        (602.9930582010581,599.7736809199871),
                        (602.8435918367348,599.2279358600584),
                        (602.7355948601663,598.835494978944),
                        (602.6700650037793,598.5984768383544),
                        (602.648,598.519),
                        (601.9979547325103,596.1691399176956),
                        (601.547193415638,594.5396748971193),
                        (601.2387777777778,593.4247777777778),
                        (601.015769547325,592.618621399177),
                        (600.8212304526749,591.915378600823),
                        (600.5982222222224,591.1092222222223),
                        (600.289806584362,589.9943251028807),
                        (599.8390452674897,588.3648600823045),
                        (625.695,667.64),
                        (625.3427711468831,667.1696313519506),
                        (624.9830092830091,666.6373108931883),
                        (624.6160495035408,666.0449960725732),
                        (624.242226903641,665.3946443389635),
                        (623.8618765784729,664.6882131412187),
                        (623.4753336231993,663.9276599281978),
                        (623.0829331329828,663.1149421487603),
                        (622.6850102029865,662.2520172517649),
                        (622.2818999283732,661.3408426860708),
                        (621.8739374043059,660.3833759005373),
                        (621.4614577259475,659.3815743440233),
                        (621.0447959884609,658.3373954653881),
                        (620.624287287009,657.2527967134907),
                        (620.2002667167544,656.1297355371901),
                        (619.7730693728603,654.9701693853456),
                        (619.3430303504896,653.7760557068165),
                        (618.9104847448049,652.5493519504613),
                        (618.4757676509694,651.2920155651399),
                        (618.039214164146,650.0060039997109),
                        (617.6011593794973,648.6932747030335),
                        (617.1619383921864,647.3557851239668),
                        (616.7218862973763,645.9954927113703),
                        (616.2813381902295,644.6143549141026),
                        (615.8406291659091,643.2143291810232),
                        (615.4000943195783,641.7973729609907),
                        (614.9600687463994,640.3654437028648),
                        (614.5208875415359,638.9204988555044),
                        (614.0828858001503,637.4644958677686),
                        (613.6463986174056,635.9993921885165),
                        (613.2117610884645,634.5271452666071),
                        (612.7793083084903,633.0497125508999),
                        (612.3493753726456,631.5690514902537),
                        (611.9222973760933,630.0871195335277),
                        (611.4984094139963,628.605874129581),
                        (611.0780465815176,627.1272727272727),
                        (610.6615439738202,625.653272775462),
                        (610.2492366860665,624.185831723008),
                        (609.8414598134198,622.7269070187698),
                        (609.4385484510431,621.2784561116064),
                        (609.040837694099,619.842436450377),
                        (608.6486626377502,618.4208054839409),
                        (608.2623583771601,617.0155206611571),
                        (607.8822600074913,615.6285394308845),
                        (607.5087026239067,614.2618192419825),
                        (607.1420213215692,612.9173175433101),
                        (606.7825511956419,611.5969917837265),
                        (606.4306273412875,610.3027994120907),
                        (606.0865848536689,609.036697877262),
                        (605.750758827949,607.8006446280992),
                        (605.4234843592906,606.5965971134617),
                        (605.1050965428568,605.4265127822086),
                        (604.7959304738102,604.2923490831988),
                        (604.496321247314,603.1960634652916),
                        (604.2066039585309,602.1396133773463),
                        (603.9271137026238,601.1249562682216),
                        (603.6581855747559,600.1540495867769),
                        (603.4001546700895,599.2288507818711),
                        (603.153356083788,598.3513173023638),
                        (602.918124911014,597.5234065971134),
                        (602.6947962469307,596.7470761149797),
                        (602.4837051867006,596.0242833048214),
                        (602.285186825487,595.3569856154977),
                        (602.0995762584523,594.7471404958678),
                        (601.9272085807597,594.1967053947908),
                        (601.7684188875722,593.7076377611255),
                        (601.6235422740525,593.2818950437317),
                        (601.4929138353634,592.9214346914681),
                        (601.3768686666682,592.6282141531938),
                        (601.2757418631294,592.4041908777679),
                        (601.1898685199099,592.2513223140496),
                        (601.1195837321726,592.171565910898),
                        (601.0652225950807,592.1668791171721),
                        (601.027120203797,592.2392193817313),
                        (601.0056116534838,592.3905441534345),
                        (601.0010320393048,592.6228108811412),
                        (601.0137164564226,592.9379770137098),
                        (601.044,593.338),
                        (600.9287148201772,592.953924345009),
                        (600.833387982906,592.6546425252939),
                        (600.7576826713512,592.4381826483517),
                        (600.7012620686785,592.3025728216797),
                        (600.6637893580529,592.2458411527754),
                        (600.6449277226401,592.2660157491352),
                        (600.6443403456049,592.3611247182569),
                        (600.6616904101127,592.5291961676373),
                        (600.6966410993291,592.7682582047738),
                        (600.7488555964192,593.0763389371634),
                        (600.817997084548,593.4514664723031),
                        (600.9037287468815,593.8916689176905),
                        (601.0057137665843,594.3949743808224),
                        (601.1236153268219,594.9594109691961),
                        (601.2570966107598,595.5830067903088),
                        (601.405820801563,596.2637899516574),
                        (601.5694510823971,596.9997885607394),
                        (601.7476506364271,597.7890307250516),
                        (601.9400826468185,598.6295445520915),
                        (602.1464102967366,599.5193581493561),
                        (602.3662967693464,600.4564996243427),
                        (602.5994052478135,601.438997084548),
                        (602.845398915303,602.4648786374697),
                        (603.1039409549802,603.5321723906047),
                        (603.3746945500105,604.6389064514503),
                        (603.6573228835593,605.7831089275036),
                        (603.9514891387917,606.9628079262615),
                        (604.2568564988729,608.1760315552217),
                        (604.5730881469686,609.4208079218806),
                        (604.8998472662437,610.6951651337363),
                        (605.2367970398635,611.9971312982852),
                        (605.5836006509935,613.3247345230245),
                        (605.9399212827988,614.6760029154519),
                        (606.3054221184449,616.048964583064),
                        (606.6797663410969,617.4416476333583),
                        (607.0626171339203,618.8520801738318),
                        (607.4536376800801,620.2782903119818),
                        (607.8524911627417,621.7183061553053),
                        (608.2588407650707,623.1701558112995),
                        (608.6723496702319,624.6318673874616),
                        (609.0926810613909,626.1014689912887),
                        (609.519498121713,627.576988730278),
                        (609.9524640343634,629.0564547119267),
                        (610.3912419825073,630.5378950437317),
                        (610.8354951493101,632.0193378331907),
                        (611.2848867179371,633.4988111878001),
                        (611.7390798715538,634.9743432150577),
                        (612.197737793325,636.4439620224605),
                        (612.6605236664162,637.9056957175055),
                        (613.1271006739929,639.3575724076902),
                        (613.5971319992203,640.7976202005112),
                        (614.0702808252635,642.223867203466),
                        (614.5462103352879,643.6343415240519),
                        (615.0245837124588,645.0270712697658),
                        (615.5050641399417,646.4000845481049),
                        (615.9873148009017,647.7514094665664),
                        (616.4709988785039,649.0790741326475),
                        (616.9557795559139,650.3811066538453),
                        (617.4413200162967,651.6555351376571),
                        (617.927283442818,652.9003876915798),
                        (618.4133330186427,654.1136924231105),
                        (618.8991319269363,655.2934774397469),
                        (619.384343350864,656.4377708489856),
                        (619.8686304735912,657.544600758324),
                        (620.3516564782832,658.6119952752595),
                        (620.833084548105,659.6379825072886),
                        (621.3125778662221,660.620590561909),
                        (621.7897996157999,661.5578475466176),
                        (622.2644129800036,662.4477815689118),
                        (622.7360811419985,663.2884207362885),
                        (623.2044672849498,664.0777931562449),
                        (623.6692345920229,664.8139269362784),
                        (624.1300462463831,665.4948501838859),
                        (624.5865654311954,666.1185910065647),
                        (625.0384553296257,666.6831775118117),
                        (625.4853791248389,667.1866378071245),
                        (625.927,667.627),
                        (625.006874415638,664.8442285761316),
                        (624.1196205102881,662.1781500905349),
                        (623.2648225555556,659.6269182222222),
                        (622.4420648230453,657.1886866502057),
                        (621.6509315843621,654.861609053498),
                        (620.8910071111112,652.6438391111111),
                        (620.161875674897,650.5335305020577),
                        (619.463121547325,648.5288369053497),
                        (618.7943290000001,646.6279119999999),
                        (618.1550823045268,644.8289094650205),
                        (617.5449657325104,643.1299829794237),
                        (616.9635635555555,641.5292862222223),
                        (616.4104600452674,640.0249728724278),
                        (615.8852394732511,638.6151966090534),
                        (615.3874861111111,637.2981111111111),
                        (614.9167842304528,636.0718700576132),
                        (614.4727181028807,634.9346271275721),
                        (614.054872,633.884536),
                        (613.6628301934159,632.9197503539093),
                        (613.2961769547326,632.0384238683127),
                        (612.9544965555555,631.2387102222222),
                        (612.6373732674896,630.5187630946502),
                        (612.34439136214,629.8767361646089),
                        (612.0751351111112,629.3107831111112),
                        (611.8291887860082,628.8190576131686),
                        (611.6061366584363,628.3997133497942),
                        (611.4055629999999,628.050904),
                        (611.2270520823046,627.7707832427983),
                        (611.0701881769548,627.5575047572016),
                        (610.9345555555556,627.4092222222223),
                        (610.8197384897119,627.3240893168725),
                        (610.7253212510288,627.3002597201646),
                        (610.6508881111112,627.335887111111),
                        (610.5960233415638,627.4291251687242),
                        (610.5603112139917,627.5781275720165),
                        (610.5433359999998,627.781048),
                        (610.5446819711934,628.0360401316873),
                        (610.5639333991769,628.3412576460905),
                        (610.6006745555554,628.6948542222223),
                        (610.6544897119343,629.0949835390945),
                        (610.7249631399177,629.53979927572),
                        (610.8116791111112,630.0274551111111),
                        (610.9142218971193,630.5561047242797),
                        (611.0321757695474,631.1239017942386),
                        (611.165125,631.7289999999998),
                        (611.3126538600823,632.3695530205762),
                        (611.4743466213993,633.0437145349795),
                        (611.6497875555556,633.7496382222222),
                        (611.8385609341564,634.4854777613169),
                        (612.0402510288066,635.2493868312758),
                        (612.2544421111112,636.0395191111111),
                        (612.4807184526749,636.8540282798353),
                        (612.7186643251028,637.6910680164609),
                        (612.967864,638.5487919999999),
                        (613.2279017489712,639.425353909465),
                        (613.4983618436213,640.3189074238683),
                        (613.7788285555556,641.2276062222222),
                        (614.0688861563787,642.149603983539),
                        (614.3681189176955,643.0830543868311),
                        (614.6761111111111,644.026111111111),
                        (614.9924470082306,644.9769278353908),
                        (615.3167108806585,645.933658238683),
                        (615.648487,646.894456),
                        (615.9873596378601,647.8574747983539),
                        (616.3329130658436,648.8208683127572),
                        (616.6847315555555,649.7827902222222),
                        (617.0423993786007,650.7413942057614),
                        (617.4055008065844,651.6948339423868),
                        (617.7736201111111,652.6412631111111),
                        (618.1463415637861,653.5788353909466),
                        (618.523249436214,654.5057044609053),
                        (618.9039280000002,655.420024),
                        (619.2879615267491,656.3199476872428),
                        (619.6749342880659,657.2036292016461),
                        (620.0644305555555,658.0692222222222),
                        (620.456034600823,658.9148804279835),
                        (620.8493306954732,659.7387574979423),
                        (621.2439031111112,660.5390071111112),
                        (621.6393361193416,661.313782946502),
                        (622.0352139917695,662.0612386831275),
                        (622.431121,662.7795279999999),
                        (622.8266414156379,663.4668045761317),
                        (623.221359510288,664.121222090535),
                        (623.6148595555554,664.7409342222222),
                        (624.0067258230453,665.3240946502059),
                        (624.396542584362,665.8688570534979),
                        (624.7838941111112,666.373375111111),
                        (625.1683646748971,666.8358025020576),
                        (625.5495385473251,667.2542929053499) )


        i:int = 0
        for layer_name, curve_set_in_a_layer in linear_approximate_curve:
            for curve in curve_set_in_a_layer:
                for part in curve:
                    p_seq = part.point_sequence
                    for point in p_seq:
                        self.assertEqual(point.x, the_answers[i][0])
                        self.assertEqual(point.y, the_answers[i][1])
                        i += 1
                    #end for
                #end for
            #end for
        #end for
    #end def

#end

#end class

if __name__ == '__main__':
    unittest.main()
#end
